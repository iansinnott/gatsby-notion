import { BlockType } from './types';
import mapIntermediateContentRepresentation from './mapIntermediateContentRepresentation';
import renderToHtml from './renderers/html';
import { inspect } from 'util';

const blocks = [
  {
    id: '35d7c634-f31a-45f8-a909-25c5496af9db',
    version: 20,
    type: 'page',
    properties: {
      Tags: 'bloggable',
      Date: '2020-04-15T00:00:00.000Z',
      Name: 'test me out',
    },
    created_time: 1586853544538,
    last_edited_time: 1586962500000,
    parent_id: 'a5dcaa10-fb50-4c7b-bc5a-bdb20cd9397d',
    parent_table: 'collection',
    alive: true,
    created_by_table: 'notion_user',
    created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
    last_edited_by_table: 'notion_user',
    last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
    _notionBlockId: '35d7c634-f31a-45f8-a909-25c5496af9db',
    _propertyDetails: {
      Tags: {
        pid: '7c:5',
        value: 'bloggable',
        _raw: '[["bloggable"]]',
        name: 'Tags',
        type: 'multi_select',
      },
      Date: {
        pid: 'mM>l',
        value: '2020-04-15T00:00:00.000Z',
        _raw: '[["‣",[["d",{"type":"date","start_date":"2020-04-15"}]]]]',
        name: 'Date',
        type: 'date',
      },
      Name: {
        pid: 'title',
        value: 'test me out',
        _raw: '[["test me out"]]',
        name: 'Name',
        type: 'title',
      },
    },
    content: undefined,
  },
  {
    id: 'ac5fc958-75b6-4b0f-9f54-8192226d2d7d',
    version: 42,
    type: 'page',
    properties: {
      Tags: 'billiards,bloggable',
      Date: '2019-08-15T00:00:00.000Z',
      Name: 'before you go go ',
    },
    content: [
      {
        id: '0f09a4b6-ca62-48a0-adb4-4a279000ed3c',
        version: 56,
        type: 'header',
        properties: { title: [['Content testing']] },
        created_time: 1586950020000,
        last_edited_time: 1586950020000,
        parent_id: 'ac5fc958-75b6-4b0f-9f54-8192226d2d7d',
        parent_table: 'block',
        alive: true,
        created_by_table: 'notion_user',
        created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
        last_edited_by_table: 'notion_user',
        last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
      },
      {
        id: 'd12ec8ca-8af6-4cbb-a4d9-3aae0e9529a8',
        version: 182,
        type: 'text',
        properties: {
          title: [
            ['This page will have '],
            ['some', [['i']]],
            [' content. The '],
            ['idea ', [['b']]],
            ['will', [['b'], ['i']]],
            [' be', [['b']]],
            [
              ' to get a sense of how content will be represented coming back from the server.',
            ],
          ],
        },
        created_time: 1586950020000,
        last_edited_time: 1587373140000,
        parent_id: 'ac5fc958-75b6-4b0f-9f54-8192226d2d7d',
        parent_table: 'block',
        alive: true,
        created_by_table: 'notion_user',
        created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
        last_edited_by_table: 'notion_user',
        last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
      },
      {
        id: 'e9e193d2-89ab-4fe4-8386-bf0ca4e5cc5f',
        version: 18,
        type: 'text',
        properties: {
          title: [
            ['Here is '],
            [
              'a link',
              [
                [
                  'a',
                  'https://www.raspberrypi.org/documentation/installation/installing-images/mac.md',
                ],
              ],
            ],
            ['.'],
          ],
        },
        created_time: 1587379860000,
        last_edited_time: 1587379860000,
        parent_id: 'ac5fc958-75b6-4b0f-9f54-8192226d2d7d',
        parent_table: 'block',
        alive: true,
        created_by_table: 'notion_user',
        created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
        last_edited_by_table: 'notion_user',
        last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
      },
      {
        id: 'a6387b62-2dee-41e2-a05d-43d9dfbd3fd0',
        version: 9,
        type: 'text',
        created_time: 1586950080000,
        last_edited_time: 1586950080000,
        parent_id: 'ac5fc958-75b6-4b0f-9f54-8192226d2d7d',
        parent_table: 'block',
        alive: true,
        created_by_table: 'notion_user',
        created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
        last_edited_by_table: 'notion_user',
        last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
      },
      {
        id: 'e87794b0-9d85-48ad-bd20-c6ad0c26ae6a',
        version: 63,
        type: 'code',
        properties: {
          title: [['Here is a code block. Quite nice ']],
          language: [['JavaScript']],
        },
        created_time: 1586950080000,
        last_edited_time: 1586950080000,
        parent_id: 'ac5fc958-75b6-4b0f-9f54-8192226d2d7d',
        parent_table: 'block',
        alive: true,
        created_by_table: 'notion_user',
        created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
        last_edited_by_table: 'notion_user',
        last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
      },
      {
        id: '1223ce86-b7d0-4f08-b2c9-2cf4ccf8f28f',
        version: 15,
        type: 'text',
        created_time: 1586950080000,
        last_edited_time: 1586950080000,
        parent_id: 'ac5fc958-75b6-4b0f-9f54-8192226d2d7d',
        parent_table: 'block',
        alive: true,
        created_by_table: 'notion_user',
        created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
        last_edited_by_table: 'notion_user',
        last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
      },
      {
        id: '82006f40-d600-49d3-8f0d-fe5b5b944155',
        version: 12,
        type: 'image',
        properties: {
          source: [
            [
              'https://s3-us-west-2.amazonaws.com/secure.notion-static.com/93db8594-47ce-4c19-b25c-eaf4c585385c/2020-04-13_at_3.11_PM.png',
            ],
          ],
          caption: [['What if an '], ['image', [['b']]], [' has a caption?']],
        },
        format: {
          block_width: 993,
          display_source:
            'https://s3-us-west-2.amazonaws.com/secure.notion-static.com/93db8594-47ce-4c19-b25c-eaf4c585385c/2020-04-13_at_3.11_PM.png',
          block_full_width: false,
          block_page_width: true,
          block_aspect_ratio: 0.6304128902316214,
          block_preserve_scale: true,
        },
        created_time: 1586950108267,
        last_edited_time: 1586950080000,
        parent_id: 'ac5fc958-75b6-4b0f-9f54-8192226d2d7d',
        parent_table: 'block',
        alive: true,
        file_ids: ['93db8594-47ce-4c19-b25c-eaf4c585385c'],
        created_by_table: 'notion_user',
        created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
        last_edited_by_table: 'notion_user',
        last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
      },
    ],
    created_time: 1586853544538,
    last_edited_time: 1587373140000,
    parent_id: 'a5dcaa10-fb50-4c7b-bc5a-bdb20cd9397d',
    parent_table: 'collection',
    alive: true,
    created_by_table: 'notion_user',
    created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
    last_edited_by_table: 'notion_user',
    last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
    _notionBlockId: 'ac5fc958-75b6-4b0f-9f54-8192226d2d7d',
    _propertyDetails: {
      Tags: {
        pid: '7c:5',
        value: 'billiards,bloggable',
        _raw: '[["billiards,bloggable"]]',
        name: 'Tags',
        type: 'multi_select',
      },
      Date: {
        pid: 'mM>l',
        value: '2019-08-15T00:00:00.000Z',
        _raw: '[["‣",[["d",{"type":"date","start_date":"2019-08-15"}]]]]',
        name: 'Date',
        type: 'date',
      },
      Name: {
        pid: 'title',
        value: 'before you go go ',
        _raw: '[["before you go go "]]',
        name: 'Name',
        type: 'title',
      },
    },
  },
  {
    id: '85070601-db92-480b-985f-1ad98b37a8df',
    version: 19,
    type: 'page',
    properties: { Date: '2010-02-02T00:00:00.000Z', Name: 'hey hey hey' },
    created_time: 1586853544538,
    last_edited_time: 1586962500000,
    parent_id: 'a5dcaa10-fb50-4c7b-bc5a-bdb20cd9397d',
    parent_table: 'collection',
    alive: true,
    created_by_table: 'notion_user',
    created_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
    last_edited_by_table: 'notion_user',
    last_edited_by_id: '0c9481d1-e23d-4b54-bd77-5637e63ae4f1',
    _notionBlockId: '85070601-db92-480b-985f-1ad98b37a8df',
    _propertyDetails: {
      Date: {
        pid: 'mM>l',
        value: '2010-02-02T00:00:00.000Z',
        _raw: '[["‣",[["d",{"type":"date","start_date":"2010-02-02"}]]]]',
        name: 'Date',
        type: 'date',
      },
      Name: {
        pid: 'title',
        value: 'hey hey hey',
        _raw: '[["hey hey hey"]]',
        name: 'Name',
        type: 'title',
      },
    },
    content: undefined,
  },
];

const parseBlockNodes = (xs: BlockType[]): object => {
  return xs.map(mapIntermediateContentRepresentation).map((x) => {
    return {
      ...x,
      html: renderToHtml(x),
    };
  });
};

console.log(
  inspect(parseBlockNodes(blocks as BlockType[]), { colors: true, depth: 20 }),
);
